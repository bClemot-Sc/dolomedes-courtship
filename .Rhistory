# Import packages
library(tidyverse)
library(nortest)
library(ggplot2)
library(tools)
library(stringr)
set.seed(42)
# Import data
data <- read.csv("mating_data.csv")
unmated.df <- data %>% filter(female.mated.before==FALSE)
mated.df <- data %>% filter(female.mated.before==TRUE)
vars <- c(
"latency.to.court", "latency.to.mount",
"first.courtship.duration", "first.mounting.duration",
"nb.flees", "nb.courtships", "nb.mounts"
)
# Compute per group Mean and SE
group_stats <- data %>%
pivot_longer(
cols = all_of(vars),
names_to = "Variable",
values_to = "Value"
) %>%
group_by(female.mated.before, Variable) %>%
summarise(
Mean = mean(Value, na.rm = TRUE),
SE   = sd(Value, na.rm = TRUE) / sqrt(sum(!is.na(Value))),
N    = sum(!is.na(Value)),
.groups = "drop"
) %>%
mutate(Group = ifelse(female.mated.before, "mated", "unmated")) %>%
select(-female.mated.before)
# Compute paired Mean difference and SE
paired_diff <- data %>%
pivot_longer(
cols = all_of(vars),
names_to = "Variable",
values_to = "Value"
) %>%
select(female, female.mated.before, Variable, Value) %>%
pivot_wider(
id_cols = c(female, Variable),
names_from = female.mated.before,
values_from = Value
) %>%
rename(
unmated = `FALSE`,
mated   = `TRUE`
) %>%
filter(!is.na(unmated) & !is.na(mated)) %>%
mutate(Diff = unmated - mated) %>%
group_by(Variable) %>%
summarise(
MeanDiff = mean(Diff),
SEDiff   = sd(Diff) / sqrt(n()),
N_pairs  = n(),
.groups = "drop"
)
# Results table
final_summary <- group_stats %>%
pivot_wider(
names_from = Group,
values_from = c(Mean, SE, N),
names_sep = "_"
) %>%
left_join(paired_diff, by = "Variable") %>%
select(
Variable,
Mean_unmated, SE_unmated, N_unmated,
Mean_mated,   SE_mated,   N_mated,
MeanDiff, SEDiff, N_pairs
)
View(final_summary)
